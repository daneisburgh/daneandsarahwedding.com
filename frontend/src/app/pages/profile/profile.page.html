<ion-content>
    <div class="content-outer page-outer">
        <ion-header>
            <ion-toolbar color="primary">
                <ion-title class="content-inner title grid">
                    <ion-grid>
                        <ion-row>
                            <ion-col size="6">
                                {{user.name}}
                            </ion-col>
                            <ion-col size="6" class="ion-text-right deadline">
                                <div *ngIf="!isMobile">{{deadlineMessage}}</div>
                                <ion-icon *ngIf="isMobile" name="information-circle"
                                    (click)="presentDeadlinePopover($event)">
                                </ion-icon>
                            </ion-col>
                        </ion-row>
                    </ion-grid>
                </ion-title>
            </ion-toolbar>
        </ion-header>
        <div class="content-inner">
            <ion-grid class="page-grid">
                <ion-row>
                    <ion-col size="12" size-lg="6">
                        <ion-card color="light">
                            <ion-card-header color="primary">
                                <ion-card-title>RSVP</ion-card-title>
                            </ion-card-header>
                            <ion-card-content>
                                <ion-item color="light" lines="none">
                                    <ion-label>Will you attend the wedding?</ion-label>
                                    <ion-select *ngIf="!isUpdating['isAttending']" class="select" placeholder="Select"
                                        [value]="user.isAttending" [disabled]="deadlineExpired"
                                        (ionChange)="updateColumn('isAttending', $event.detail.value)">
                                        <ion-select-option [value]="true">Yes</ion-select-option>
                                        <ion-select-option [value]="false">No</ion-select-option>
                                    </ion-select>
                                    <ion-spinner *ngIf="isUpdating['isAttending']" slot="end"></ion-spinner>
                                </ion-item>
                            </ion-card-content>
                        </ion-card>
                    </ion-col>
                    <ion-col size="12" size-lg="6">
                        <ion-card color="light" lines="none">
                            <ion-card-header color="primary" class="email">
                                <ion-card-title>
                                    Email
                                    <ion-spinner *ngIf="resendingEmailVerification" color="light"></ion-spinner>
                                    <ion-buttons *ngIf="!resendingEmailVerification">
                                        <ion-button *ngIf="!displayChangeEmail" class="change"
                                            (click)="toggleDisplayChangeEmail()">
                                            <ion-icon name="create"></ion-icon>
                                            <ion-text>Change <span *ngIf="!isMobile">Email</span></ion-text>
                                        </ion-button>
                                        <ion-button *ngIf="!displayChangeEmail && !user.isEmailVerified" class="resend"
                                            (click)="resendEmailVerification(user.email)">
                                            <ion-icon name="send"></ion-icon>
                                            <ion-text>Resend <span *ngIf="!isMobile">Verification</span></ion-text>
                                        </ion-button>
                                        <ion-button *ngIf="displayChangeEmail" class="save"
                                            [disabled]="isChangeEmailDisabled" (click)="resendEmailVerification(email)">
                                            <ion-icon name="save"></ion-icon>
                                            <ion-text>Save</ion-text>
                                        </ion-button>
                                        <ion-button *ngIf="displayChangeEmail" class="cancel"
                                            (click)="toggleDisplayChangeEmail()">
                                            <ion-icon name="close"></ion-icon>
                                            <ion-text>Cancel</ion-text>
                                        </ion-button>
                                    </ion-buttons>
                                </ion-card-title>
                            </ion-card-header>
                            <ion-card-content class="email">
                                <ion-item color="light" lines="none">
                                    <ion-label *ngIf="!displayChangeEmail">{{user.email}}</ion-label>
                                    <ion-input *ngIf="displayChangeEmail" type="text" placeholder="Input email"
                                        [(ngModel)]="email" [disabled]="resendingEmailVerification"
                                        (keydown)="changeEmailKeyDown($event)"></ion-input>
                                    <ion-text slot="end">
                                        <span *ngIf="!displayChangeEmail && user.isEmailVerified"
                                            class="email-verified">Verified</span>
                                        <span *ngIf="!displayChangeEmail && !user.isEmailVerified"
                                            class="email-error">Not verified</span>
                                        <span
                                            *ngIf="displayChangeEmail && changeEmailErrorMessage && !resendingEmailVerification"
                                            class="email-error">
                                            {{changeEmailErrorMessage}}
                                        </span>
                                    </ion-text>
                                </ion-item>
                            </ion-card-content>
                        </ion-card>
                    </ion-col>
                    <ion-col size="12" size-lg="6">
                        <ion-card color="light">
                            <ion-card-header color="primary">
                                <ion-card-title>Accommodations & Transportation</ion-card-title>
                            </ion-card-header>
                            <ion-card-content>
                                <ion-item color="light" lines="none" [disabled]="deadlineExpired || !user.isAttending">
                                    <ion-label>Will you require accommodations?</ion-label>
                                    <ion-select *ngIf="!isUpdating['requiresAccommodations']" placeholder="Select"
                                        [value]="user.requiresAccommodations"
                                        [interfaceOptions]="interfaceOptions.accommodation"
                                        (ionChange)="updateColumn('requiresAccommodations', $event.detail.value)">
                                        <ion-select-option [value]="true">Yes</ion-select-option>
                                        <ion-select-option [value]="false">No</ion-select-option>
                                    </ion-select>
                                    <ion-spinner *ngIf="isUpdating['requiresAccommodations']" slot="end"></ion-spinner>
                                </ion-item>
                                <ion-item color="light" lines="none"
                                    [disabled]="deadlineExpired || !user.isAttending || !user.requiresAccommodations">
                                    <ion-label>How many rooms will you require?</ion-label>
                                    <ion-select *ngIf="!isUpdating['totalRequiredRooms']" placeholder="Select"
                                        [value]="user.totalRequiredRooms"
                                        (ionChange)="updateColumn('totalRequiredRooms', $event.detail.value)">
                                        <ion-select-option *ngFor="let option of roomOptions" [value]="option">
                                            {{option}}
                                        </ion-select-option>
                                    </ion-select>
                                    <ion-spinner *ngIf="isUpdating['totalRequiredRooms']" slot="end"></ion-spinner>
                                </ion-item>
                                <ion-item color="light" lines="none"
                                    [disabled]="deadlineExpired || !user.isAttending || !user.requiresAccommodations">
                                    <ion-label>Will you require transportation?</ion-label>
                                    <ion-select *ngIf="!isUpdating['requiresTransportation']" placeholder="Select"
                                        [value]="user.requiresTransportation"
                                        [interfaceOptions]="interfaceOptions.transportation"
                                        (ionChange)="updateColumn('requiresTransportation', $event.detail.value)">
                                        <ion-select-option [value]="true">Yes</ion-select-option>
                                        <ion-select-option [value]="false">No</ion-select-option>
                                    </ion-select>
                                    <ion-spinner *ngIf="isUpdating['requiresTransportation']" slot="end"></ion-spinner>
                                </ion-item>
                            </ion-card-content>
                        </ion-card>
                    </ion-col>
                    <ion-col size="12" size-lg="6">
                        <ion-card color="light">
                            <ion-card-header color="primary" class="guests">
                                <ion-card-title>
                                    Guests
                                    <ion-icon *ngIf="!displayChangeGuests" name="create" class="create"
                                        (click)="toggleDisplayChangeGuests()"></ion-icon>
                                    <ion-icon *ngIf="displayChangeGuests" name="save" class="save"
                                        [ngClass]="{'disabled': isChangeGuestsDisabled}" (click)="updateGuests()">
                                    </ion-icon>
                                    <ion-icon *ngIf="displayChangeGuests" name="close" class="close"
                                        (click)="toggleDisplayChangeGuests()"></ion-icon>
                                    <ion-spinner *ngIf="isUpdating.guests" color="light"></ion-spinner>
                                </ion-card-title>
                            </ion-card-header>
                            <ion-card-content class="guests">
                                <ion-item color="light" lines="none"
                                    *ngFor="let guest of guests; index as i; trackBy: changeGuestsTrackBy">
                                    <span>{{i + 1}})</span>
                                    <ion-label *ngIf="!displayChangeGuests">{{guest}}</ion-label>
                                    <ion-input *ngIf="displayChangeGuests" type="text" placeholder="Input guest name"
                                        [(ngModel)]="guests[i]" [disabled]="isUpdating.guests"
                                        (keydown)="changeGuestsKeyDown($event)"></ion-input>
                                </ion-item>
                            </ion-card-content>
                        </ion-card>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </div>
    </div>
</ion-content>